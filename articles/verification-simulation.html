<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Verification of sample size calculation via simulation • gsDesignNB</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Verification of sample size calculation via simulation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gsDesignNB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/keaven/gsDesignNB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Verification of sample size calculation via simulation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/keaven/gsDesignNB/blob/main/vignettes/verification-simulation.Rmd" class="external-link"><code>vignettes/verification-simulation.Rmd</code></a></small>
      <div class="d-none name"><code>verification-simulation.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keaven.github.io/gsDesignNB/">gsDesignNB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com" class="external-link">gt</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette verifies the accuracy of the
<code><a href="../reference/sample_size_nbinom.html">sample_size_nbinom()</a></code> function by comparing its theoretical
predictions for average exposure, statistical information, and power
against results from a large-scale simulation study.</p>
<p>We specifically test a scenario with:</p>
<ul>
<li>Piecewise constant accrual rates.</li>
<li>Piecewise exponential dropout (constant in this example).</li>
<li>Negative binomial outcomes.</li>
<li>Fixed follow-up design.</li>
</ul>
</div>
<div class="section level2">
<h2 id="simulation-design">Simulation design<a class="anchor" aria-label="anchor" href="#simulation-design"></a>
</h2>
<p>The study sample size suggested by the Friede method is used to
evaluate the accuracy of that method. The parameters for both the
theoretical calculation and the simulation study are as follows:</p>
<div class="section level3">
<h3 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h3>
<ul>
<li>
<strong>Rates</strong>: <span class="math inline">\(\lambda_1 =
0.4\)</span> (Control), <span class="math inline">\(\lambda_2 =
0.3\)</span> (Experimental).</li>
<li>
<strong>Dispersion</strong>: <span class="math inline">\(k =
0.5\)</span>.</li>
<li>
<strong>Power</strong>: 90%.</li>
<li>
<strong>Alpha</strong>: 0.025 (one-sided).</li>
<li>
<strong>Dropout</strong>: 10% per year adjusted to monthly rate
(<span class="math inline">\(\delta = 0.1 / 12\)</span>).</li>
<li>
<strong>Trial duration</strong>: 24 months.</li>
<li>
<strong>Max follow-up</strong>: 12 months.</li>
<li>
<strong>Event gap</strong>: 30 days (approx 0.082 years).</li>
<li>
<strong>Accrual</strong>: Piecewise linear ramp-up over 12 months
(Rate <span class="math inline">\(R\)</span> for 0-6mo, <span class="math inline">\(2R\)</span> for 6-12mo).</li>
</ul>
</div>
<div class="section level3">
<h3 id="theoretical-calculation">Theoretical calculation<a class="anchor" aria-label="anchor" href="#theoretical-calculation"></a>
</h3>
<p>First, we calculate the required sample size and expected properties
using <code><a href="../reference/sample_size_nbinom.html">sample_size_nbinom()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Parameters</span></span>
<span><span class="va">lambda1</span> <span class="op">&lt;-</span> <span class="fl">0.4</span></span>
<span><span class="va">lambda2</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span><span class="va">dispersion</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">power</span> <span class="op">&lt;-</span> <span class="fl">0.9</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.025</span></span>
<span><span class="va">dropout_rate</span> <span class="op">&lt;-</span> <span class="fl">0.1</span> <span class="op">/</span> <span class="fl">12</span></span>
<span><span class="va">max_followup</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="va">trial_duration</span> <span class="op">&lt;-</span> <span class="fl">24</span></span>
<span><span class="va">event_gap</span> <span class="op">&lt;-</span> <span class="fl">20</span> <span class="op">/</span> <span class="fl">30.42</span> <span class="co"># 20 days</span></span>
<span></span>
<span><span class="co"># Accrual targeting 90% power</span></span>
<span><span class="co"># We provide relative rates (1:2) and the function scales them to achieve power</span></span>
<span><span class="va">accrual_rate_rel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">accrual_duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_size_nbinom.html">sample_size_nbinom</a></span><span class="op">(</span></span>
<span>  lambda1 <span class="op">=</span> <span class="va">lambda1</span>, lambda2 <span class="op">=</span> <span class="va">lambda2</span>, dispersion <span class="op">=</span> <span class="va">dispersion</span>,</span>
<span>  power <span class="op">=</span> <span class="va">power</span>,</span>
<span>  alpha <span class="op">=</span> <span class="va">alpha</span>, sided <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  accrual_rate <span class="op">=</span> <span class="va">accrual_rate_rel</span>,</span>
<span>  accrual_duration <span class="op">=</span> <span class="va">accrual_duration</span>,</span>
<span>  trial_duration <span class="op">=</span> <span class="va">trial_duration</span>,</span>
<span>  dropout_rate <span class="op">=</span> <span class="va">dropout_rate</span>,</span>
<span>  max_followup <span class="op">=</span> <span class="va">max_followup</span>,</span>
<span>  event_gap <span class="op">=</span> <span class="va">event_gap</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract calculated absolute accrual rates</span></span>
<span><span class="va">accrual_rate</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">$</span><span class="va">accrual_rate</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sample size for negative binomial outcome</span></span>
<span><span class="co">#&gt; ==========================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sample size:     n1 = 211, n2 = 211, total = 422</span></span>
<span><span class="co">#&gt; Expected events: 1366.9 (n1: 763.1, n2: 603.8)</span></span>
<span><span class="co">#&gt; Power: 90%, Alpha: 0.025 (1-sided)</span></span>
<span><span class="co">#&gt; Rates: control = 0.4000, treatment = 0.3000 (RR = 0.7500)</span></span>
<span><span class="co">#&gt; Dispersion: 0.5000, Avg exposure (calendar): 11.42</span></span>
<span><span class="co">#&gt; Avg exposure (at-risk): n1 = 9.04, n2 = 9.54</span></span>
<span><span class="co">#&gt; Event gap: 0.66</span></span>
<span><span class="co">#&gt; Dropout rate: 0.0083</span></span>
<span><span class="co">#&gt; Accrual: 12.0, Trial duration: 24.0</span></span>
<span><span class="co">#&gt; Max follow-up: 12.0</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="simulation-results">Simulation results<a class="anchor" aria-label="anchor" href="#simulation-results"></a>
</h2>
<p>We simulated 3,600 trials using the parameters defined above from the
Friede method. This number of simulations was chosen to achieve a
standard error for the power estimate of approximately 0.005 when the
true power is 90% (<span class="math inline">\(\sqrt{0.9 \times 0.1 /
3600} = 0.005\)</span>). The simulation script is located in
<code>data-raw/generate_simulation_data.R</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load pre-computed simulation results</span></span>
<span><span class="va">results_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"simulation_results.rds"</span>, package <span class="op">=</span> <span class="st">"gsDesignNB"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">results_file</span> <span class="op">==</span> <span class="st">""</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"../inst/extdata/simulation_results.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">results_file</span> <span class="op">&lt;-</span> <span class="st">"../inst/extdata/simulation_results.rds"</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">results_file</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">results_file</span><span class="op">)</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">results</span></span>
<span>  <span class="va">design_ref</span> <span class="op">&lt;-</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">design</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># Fallback if data is not available (e.g. not installed yet)</span></span>
<span>  <span class="co"># This block allows the vignette to build without the data, but warns.</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Simulation results not found. Skipping verification plots."</span><span class="op">)</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">design_ref</span> <span class="op">&lt;-</span> <span class="va">design</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="summary-of-verification-results">Summary of verification results<a class="anchor" aria-label="anchor" href="#summary-of-verification-results"></a>
</h3>
<p>We compare the theoretical predictions from
<code><a href="../reference/sample_size_nbinom.html">sample_size_nbinom()</a></code> with the observed simulation results
across multiple metrics.</p>
<p><strong>Key distinction: Total Exposure vs Exposure at
Risk</strong></p>
<ul>
<li>
<strong>Total Exposure</strong> (<code>tte_total</code>): The
calendar time a subject is on study, from randomization to the analysis
cut date (or censoring). This is the same for both treatment arms by
design.</li>
<li>
<strong>Exposure at Risk</strong> (<code>tte</code>): The time
during which a subject can experience a <em>new</em> event. After each
event, there is an “event gap” period during which new events are not
counted (e.g., representing recovery time or treatment effect). This
differs by treatment group because the group with more events loses more
time to gaps.</li>
</ul>
<p>The theoretical sample size calculation uses exposure at risk
internally, but reports both metrics for transparency.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ---- Compute all metrics ----</span></span>
<span></span>
<span><span class="co"># Number of simulations</span></span>
<span><span class="va">n_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Total Exposure (calendar follow-up time)</span></span>
<span><span class="co"># Note: exposure is the same for both arms in the design (by symmetry)</span></span>
<span><span class="va">theo_exposure</span> <span class="op">&lt;-</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">exposure</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Check which column names are available in the results</span></span>
<span><span class="co"># (Support both old and new naming conventions)</span></span>
<span><span class="va">has_new_cols</span> <span class="op">&lt;-</span> <span class="st">"exposure_total_control"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">has_new_cols</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">obs_exposure_ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">exposure_total_control</span><span class="op">)</span></span>
<span>  <span class="va">obs_exposure_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">exposure_total_experimental</span><span class="op">)</span></span>
<span>  <span class="va">obs_exposure_at_risk_ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">exposure_at_risk_control</span><span class="op">)</span></span>
<span>  <span class="va">obs_exposure_at_risk_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">exposure_at_risk_experimental</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># Legacy: old simulation used 'exposure_control' which was actually at-risk time</span></span>
<span>  <span class="va">obs_exposure_ctrl</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span>  <span class="va">obs_exposure_exp</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>  <span class="va">obs_exposure_at_risk_ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">exposure_control</span><span class="op">)</span></span>
<span>  <span class="va">obs_exposure_at_risk_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">exposure_experimental</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Exposure at risk (time at risk excluding event gaps)</span></span>
<span><span class="va">theo_exposure_at_risk_ctrl</span> <span class="op">&lt;-</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">exposure_at_risk_n1</span></span>
<span><span class="va">theo_exposure_at_risk_exp</span> <span class="op">&lt;-</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">exposure_at_risk_n2</span></span>
<span></span>
<span><span class="co"># Events by treatment group</span></span>
<span><span class="va">theo_events_ctrl</span> <span class="op">&lt;-</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">events_n1</span></span>
<span><span class="va">theo_events_exp</span> <span class="op">&lt;-</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">events_n2</span></span>
<span><span class="va">obs_events_ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">events_control</span><span class="op">)</span></span>
<span><span class="va">obs_events_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">events_experimental</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Treatment effect</span></span>
<span><span class="va">true_rr</span> <span class="op">&lt;-</span> <span class="va">lambda2</span> <span class="op">/</span> <span class="va">lambda1</span></span>
<span><span class="va">true_log_rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">true_rr</span><span class="op">)</span></span>
<span><span class="va">mean_log_rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">estimate</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Variance</span></span>
<span><span class="va">theo_var</span> <span class="op">&lt;-</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">variance</span></span>
<span><span class="co"># Use median of SE^2 for robust estimate</span></span>
<span><span class="va">median_se_sq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">se</span><span class="op">^</span><span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Empirical variance of estimates</span></span>
<span><span class="va">emp_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">estimate</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Power</span></span>
<span><span class="va">theo_power</span> <span class="op">&lt;-</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">power</span></span>
<span><span class="va">emp_power</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">p_value</span> <span class="op">&lt;</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">inputs</span><span class="op">$</span><span class="va">alpha</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sample size reproduction</span></span>
<span><span class="va">z_alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">inputs</span><span class="op">$</span><span class="va">alpha</span><span class="op">)</span></span>
<span><span class="va">z_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">design_ref</span><span class="op">$</span><span class="va">inputs</span><span class="op">$</span><span class="va">power</span><span class="op">)</span></span>
<span><span class="va">n_sim_total</span> <span class="op">&lt;-</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">n_total</span></span>
<span><span class="va">n_reproduced</span> <span class="op">&lt;-</span> <span class="va">n_sim_total</span> <span class="op">*</span> <span class="op">(</span><span class="va">emp_var</span> <span class="op">*</span> <span class="op">(</span><span class="va">z_alpha</span> <span class="op">+</span> <span class="va">z_beta</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">mean_log_rr</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ---- Build summary table ----</span></span>
<span><span class="va">summary_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Total Exposure (months) - Control"</span>,</span>
<span>    <span class="st">"Total Exposure (months) - Experimental"</span>,</span>
<span>    <span class="st">"Exposure at Risk (months) - Control"</span>,</span>
<span>    <span class="st">"Exposure at Risk (months) - Experimental"</span>,</span>
<span>    <span class="st">"Events per Subject - Control"</span>,</span>
<span>    <span class="st">"Events per Subject - Experimental"</span>,</span>
<span>    <span class="st">"Treatment Effect: log(RR)"</span>,</span>
<span>    <span class="st">"Variance of log(RR)"</span>,</span>
<span>    <span class="st">"Power"</span>,</span>
<span>    <span class="st">"Sample Size"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Theoretical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="va">theo_exposure</span>,</span>
<span>    <span class="va">theo_exposure</span>,</span>
<span>    <span class="va">theo_exposure_at_risk_ctrl</span>,</span>
<span>    <span class="va">theo_exposure_at_risk_exp</span>,</span>
<span>    <span class="va">theo_events_ctrl</span> <span class="op">/</span> <span class="op">(</span><span class="va">n_sim_total</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    <span class="va">theo_events_exp</span> <span class="op">/</span> <span class="op">(</span><span class="va">n_sim_total</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    <span class="va">true_log_rr</span>,</span>
<span>    <span class="va">theo_var</span>,</span>
<span>    <span class="va">theo_power</span>,</span>
<span>    <span class="va">n_sim_total</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Simulated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="va">obs_exposure_ctrl</span>,</span>
<span>    <span class="va">obs_exposure_exp</span>,</span>
<span>    <span class="va">obs_exposure_at_risk_ctrl</span>,</span>
<span>    <span class="va">obs_exposure_at_risk_exp</span>,</span>
<span>    <span class="va">obs_events_ctrl</span> <span class="op">/</span> <span class="op">(</span><span class="va">n_sim_total</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    <span class="va">obs_events_exp</span> <span class="op">/</span> <span class="op">(</span><span class="va">n_sim_total</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    <span class="va">mean_log_rr</span>,</span>
<span>    <span class="va">median_se_sq</span>,</span>
<span>    <span class="va">emp_power</span>,</span>
<span>    <span class="va">n_reproduced</span></span>
<span>  <span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">summary_df</span><span class="op">$</span><span class="va">Difference</span> <span class="op">&lt;-</span> <span class="va">summary_df</span><span class="op">$</span><span class="va">Simulated</span> <span class="op">-</span> <span class="va">summary_df</span><span class="op">$</span><span class="va">Theoretical</span></span>
<span><span class="va">summary_df</span><span class="op">$</span><span class="va">Rel_Diff_Pct</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">summary_df</span><span class="op">$</span><span class="va">Difference</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">summary_df</span><span class="op">$</span><span class="va">Theoretical</span><span class="op">)</span></span>
<span></span>
<span><span class="va">summary_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html" class="external-link">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_header.html" class="external-link">tab_header</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/md.html" class="external-link">md</a></span><span class="op">(</span><span class="st">"**Verification of sample_size_nbinom() Predictions**"</span><span class="op">)</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Based on "</span>, <span class="va">n_sims</span>, <span class="st">" simulated trials"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_row_group.html" class="external-link">tab_row_group</a></span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/md.html" class="external-link">md</a></span><span class="op">(</span><span class="st">"**Sample Size**"</span><span class="op">)</span>,</span>
<span>    rows <span class="op">=</span> <span class="va">Metric</span> <span class="op">==</span> <span class="st">"Sample Size"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_row_group.html" class="external-link">tab_row_group</a></span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/md.html" class="external-link">md</a></span><span class="op">(</span><span class="st">"**Power**"</span><span class="op">)</span>,</span>
<span>    rows <span class="op">=</span> <span class="va">Metric</span> <span class="op">==</span> <span class="st">"Power"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_row_group.html" class="external-link">tab_row_group</a></span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/md.html" class="external-link">md</a></span><span class="op">(</span><span class="st">"**Variance**"</span><span class="op">)</span>,</span>
<span>    rows <span class="op">=</span> <span class="va">Metric</span> <span class="op">==</span> <span class="st">"Variance of log(RR)"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_row_group.html" class="external-link">tab_row_group</a></span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/md.html" class="external-link">md</a></span><span class="op">(</span><span class="st">"**Treatment Effect**"</span><span class="op">)</span>,</span>
<span>    rows <span class="op">=</span> <span class="va">Metric</span> <span class="op">==</span> <span class="st">"Treatment Effect: log(RR)"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_row_group.html" class="external-link">tab_row_group</a></span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/md.html" class="external-link">md</a></span><span class="op">(</span><span class="st">"**Events**"</span><span class="op">)</span>,</span>
<span>    rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Events"</span>, <span class="va">Metric</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_row_group.html" class="external-link">tab_row_group</a></span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/md.html" class="external-link">md</a></span><span class="op">(</span><span class="st">"**Exposure**"</span><span class="op">)</span>,</span>
<span>    rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Exposure"</span>, <span class="va">Metric</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/row_group_order.html" class="external-link">row_group_order</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"**Exposure**"</span>, <span class="st">"**Events**"</span>, <span class="st">"**Treatment Effect**"</span>,</span>
<span>                              <span class="st">"**Variance**"</span>, <span class="st">"**Power**"</span>, <span class="st">"**Sample Size**"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html" class="external-link">fmt_number</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Theoretical</span>, <span class="va">Simulated</span>, <span class="va">Difference</span><span class="op">)</span>, decimals <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html" class="external-link">fmt_number</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="va">Rel_Diff_Pct</span>, decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/cols_label.html" class="external-link">cols_label</a></span><span class="op">(</span></span>
<span>    Metric <span class="op">=</span> <span class="st">""</span>,</span>
<span>    Theoretical <span class="op">=</span> <span class="st">"Theoretical"</span>,</span>
<span>    Simulated <span class="op">=</span> <span class="st">"Simulated"</span>,</span>
<span>    Difference <span class="op">=</span> <span class="st">"Difference"</span>,</span>
<span>    Rel_Diff_Pct <span class="op">=</span> <span class="st">"Rel. Diff (%)"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/sub_missing.html" class="external-link">sub_missing</a></span><span class="op">(</span>missing_text <span class="op">=</span> <span class="st">"—"</span><span class="op">)</span></span></code></pre></div>
<div id="mwlefoodfi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mwlefoodfi table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mwlefoodfi thead, #mwlefoodfi tbody, #mwlefoodfi tfoot, #mwlefoodfi tr, #mwlefoodfi td, #mwlefoodfi th {
  border-style: none;
}

#mwlefoodfi p {
  margin: 0;
  padding: 0;
}

#mwlefoodfi .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mwlefoodfi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mwlefoodfi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mwlefoodfi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mwlefoodfi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mwlefoodfi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mwlefoodfi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mwlefoodfi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mwlefoodfi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mwlefoodfi .gt_spanner_row {
  border-bottom-style: hidden;
}

#mwlefoodfi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mwlefoodfi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mwlefoodfi .gt_from_md > :first-child {
  margin-top: 0;
}

#mwlefoodfi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mwlefoodfi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mwlefoodfi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mwlefoodfi .gt_row_group_first td {
  border-top-width: 2px;
}

#mwlefoodfi .gt_row_group_first th {
  border-top-width: 2px;
}

#mwlefoodfi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mwlefoodfi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mwlefoodfi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mwlefoodfi .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mwlefoodfi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_left {
  text-align: left;
}

#mwlefoodfi .gt_center {
  text-align: center;
}

#mwlefoodfi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mwlefoodfi .gt_font_normal {
  font-weight: normal;
}

#mwlefoodfi .gt_font_bold {
  font-weight: bold;
}

#mwlefoodfi .gt_font_italic {
  font-style: italic;
}

#mwlefoodfi .gt_super {
  font-size: 65%;
}

#mwlefoodfi .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mwlefoodfi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mwlefoodfi .gt_indent_1 {
  text-indent: 5px;
}

#mwlefoodfi .gt_indent_2 {
  text-indent: 10px;
}

#mwlefoodfi .gt_indent_3 {
  text-indent: 15px;
}

#mwlefoodfi .gt_indent_4 {
  text-indent: 20px;
}

#mwlefoodfi .gt_indent_5 {
  text-indent: 25px;
}

#mwlefoodfi .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mwlefoodfi div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading">
<td colspan="5" class="gt_heading gt_title gt_font_normal" style><span class="gt_from_md"><strong>Verification of sample_size_nbinom() Predictions</strong></span></td>
    </tr>
<tr class="gt_heading">
<td colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style>Based on 3600 simulated trials</td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Metric"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Theoretical">Theoretical</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Simulated">Simulated</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Difference">Difference</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Rel_Diff_Pct">Rel. Diff (%)</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row">
<th colspan="5" class="gt_group_heading" scope="colgroup" id="&lt;span class='gt_from_md'&gt;&lt;strong&gt;Exposure&lt;/strong&gt;&lt;/span&gt;"><span class="gt_from_md"><strong>Exposure</strong></span></th>
    </tr>
<tr class="gt_row_group_first">
<td headers="**Exposure**  Metric" class="gt_row gt_left">Total Exposure (months) - Control</td>
<td headers="**Exposure**  Theoretical" class="gt_row gt_right">11.4195</td>
<td headers="**Exposure**  Simulated" class="gt_row gt_right">11.4156</td>
<td headers="**Exposure**  Difference" class="gt_row gt_right">−0.0039</td>
<td headers="**Exposure**  Rel_Diff_Pct" class="gt_row gt_right">−0.03</td>
</tr>
<tr>
<td headers="**Exposure**  Metric" class="gt_row gt_left">Total Exposure (months) - Experimental</td>
<td headers="**Exposure**  Theoretical" class="gt_row gt_right">11.4195</td>
<td headers="**Exposure**  Simulated" class="gt_row gt_right">11.4167</td>
<td headers="**Exposure**  Difference" class="gt_row gt_right">−0.0029</td>
<td headers="**Exposure**  Rel_Diff_Pct" class="gt_row gt_right">−0.03</td>
</tr>
<tr>
<td headers="**Exposure**  Metric" class="gt_row gt_left">Exposure at Risk (months) - Control</td>
<td headers="**Exposure**  Theoretical" class="gt_row gt_right">9.0417</td>
<td headers="**Exposure**  Simulated" class="gt_row gt_right">9.2581</td>
<td headers="**Exposure**  Difference" class="gt_row gt_right">0.2164</td>
<td headers="**Exposure**  Rel_Diff_Pct" class="gt_row gt_right">2.39</td>
</tr>
<tr>
<td headers="**Exposure**  Metric" class="gt_row gt_left">Exposure at Risk (months) - Experimental</td>
<td headers="**Exposure**  Theoretical" class="gt_row gt_right">9.5382</td>
<td headers="**Exposure**  Simulated" class="gt_row gt_right">9.6935</td>
<td headers="**Exposure**  Difference" class="gt_row gt_right">0.1553</td>
<td headers="**Exposure**  Rel_Diff_Pct" class="gt_row gt_right">1.63</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="5" class="gt_group_heading" scope="colgroup" id="&lt;span class='gt_from_md'&gt;&lt;strong&gt;Events&lt;/strong&gt;&lt;/span&gt;"><span class="gt_from_md"><strong>Events</strong></span></th>
    </tr>
<tr class="gt_row_group_first">
<td headers="**Events**  Metric" class="gt_row gt_left">Events per Subject - Control</td>
<td headers="**Events**  Theoretical" class="gt_row gt_right">3.6167</td>
<td headers="**Events**  Simulated" class="gt_row gt_right">3.3778</td>
<td headers="**Events**  Difference" class="gt_row gt_right">−0.2389</td>
<td headers="**Events**  Rel_Diff_Pct" class="gt_row gt_right">−6.61</td>
</tr>
<tr>
<td headers="**Events**  Metric" class="gt_row gt_left">Events per Subject - Experimental</td>
<td headers="**Events**  Theoretical" class="gt_row gt_right">2.8615</td>
<td headers="**Events**  Simulated" class="gt_row gt_right">2.6983</td>
<td headers="**Events**  Difference" class="gt_row gt_right">−0.1631</td>
<td headers="**Events**  Rel_Diff_Pct" class="gt_row gt_right">−5.70</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="5" class="gt_group_heading" scope="colgroup" id="&lt;span class='gt_from_md'&gt;&lt;strong&gt;Treatment Effect&lt;/strong&gt;&lt;/span&gt;"><span class="gt_from_md"><strong>Treatment Effect</strong></span></th>
    </tr>
<tr class="gt_row_group_first">
<td headers="**Treatment Effect**  Metric" class="gt_row gt_left">Treatment Effect: log(RR)</td>
<td headers="**Treatment Effect**  Theoretical" class="gt_row gt_right">−0.2877</td>
<td headers="**Treatment Effect**  Simulated" class="gt_row gt_right">−0.2891</td>
<td headers="**Treatment Effect**  Difference" class="gt_row gt_right">−0.0014</td>
<td headers="**Treatment Effect**  Rel_Diff_Pct" class="gt_row gt_right">−0.48</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="5" class="gt_group_heading" scope="colgroup" id="&lt;span class='gt_from_md'&gt;&lt;strong&gt;Variance&lt;/strong&gt;&lt;/span&gt;"><span class="gt_from_md"><strong>Variance</strong></span></th>
    </tr>
<tr class="gt_row_group_first">
<td headers="**Variance**  Metric" class="gt_row gt_left">Variance of log(RR)</td>
<td headers="**Variance**  Theoretical" class="gt_row gt_right">0.0079</td>
<td headers="**Variance**  Simulated" class="gt_row gt_right">0.0078</td>
<td headers="**Variance**  Difference" class="gt_row gt_right">−0.0001</td>
<td headers="**Variance**  Rel_Diff_Pct" class="gt_row gt_right">−1.11</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="5" class="gt_group_heading" scope="colgroup" id="&lt;span class='gt_from_md'&gt;&lt;strong&gt;Power&lt;/strong&gt;&lt;/span&gt;"><span class="gt_from_md"><strong>Power</strong></span></th>
    </tr>
<tr class="gt_row_group_first">
<td headers="**Power**  Metric" class="gt_row gt_left">Power</td>
<td headers="**Power**  Theoretical" class="gt_row gt_right">0.9000</td>
<td headers="**Power**  Simulated" class="gt_row gt_right">0.8992</td>
<td headers="**Power**  Difference" class="gt_row gt_right">−0.0008</td>
<td headers="**Power**  Rel_Diff_Pct" class="gt_row gt_right">−0.09</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="5" class="gt_group_heading" scope="colgroup" id="&lt;span class='gt_from_md'&gt;&lt;strong&gt;Sample Size&lt;/strong&gt;&lt;/span&gt;"><span class="gt_from_md"><strong>Sample Size</strong></span></th>
    </tr>
<tr class="gt_row_group_first">
<td headers="**Sample Size**  Metric" class="gt_row gt_left">Sample Size</td>
<td headers="**Sample Size**  Theoretical" class="gt_row gt_right">422.0000</td>
<td headers="**Sample Size**  Simulated" class="gt_row gt_right">437.2366</td>
<td headers="**Sample Size**  Difference" class="gt_row gt_right">15.2366</td>
<td headers="**Sample Size**  Rel_Diff_Pct" class="gt_row gt_right">3.61</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Notes:</strong></p>
<ul>
<li>
<strong>Total Exposure</strong> is the average calendar follow-up
time per subject. The theoretical value is the same for both arms
(symmetric design), while simulated values may differ slightly due to
sampling variability in enrollment and dropout.</li>
<li>
<strong>Exposure at Risk</strong> is the time during which new
events can occur, after subtracting the “event gap” periods following
each event. The control group has lower exposure at risk because it
experiences more events (higher rate), each followed by a gap
period.</li>
<li>
<strong>Events per Subject</strong> is the mean number of events per
subject in each treatment group.</li>
<li>
<strong>Variance</strong> uses the median of the estimated variances
(SE²) from each simulation, which is robust to outliers from unstable
model fits.</li>
<li>
<strong>Sample Size</strong> is back-calculated using the standard
asymptotic formula with the observed treatment effect and variance.</li>
</ul>
<div class="section level4">
<h4 id="power-confidence-interval">Power confidence interval<a class="anchor" aria-label="anchor" href="#power-confidence-interval"></a>
</h4>
<p>A 95% confidence interval for the empirical power confirms that the
theoretical power falls within the simulation error bounds.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html" class="external-link">binom.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">p_value</span> <span class="op">&lt;</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">inputs</span><span class="op">$</span><span class="va">alpha</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"95% CI for empirical power: ["</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">power_ci</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">", "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">power_ci</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"]\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; 95% CI for empirical power: [0.8889, 0.9088]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Theoretical power:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">theo_power</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Theoretical power: 0.9</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="distribution-of-the-test-statistic">Distribution of the test statistic<a class="anchor" aria-label="anchor" href="#distribution-of-the-test-statistic"></a>
</h3>
<p>Here we plot the density of the Wald Z-scores from the simulation and
compare it to the expected normal distribution centered at the
theoretical mean Z-score.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate Z-scores using estimated variance (Wald statistic)</span></span>
<span><span class="co"># Z = (hat(delta) - 0) / SE_est</span></span>
<span><span class="va">z_scores</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">estimate</span> <span class="op">/</span> <span class="va">results</span><span class="op">$</span><span class="va">se</span></span>
<span></span>
<span><span class="co"># Theoretical mean Z-score under the alternative</span></span>
<span><span class="co"># E[Z] = log(RR) / sqrt(V_theo)</span></span>
<span><span class="va">theo_se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">theo_var</span><span class="op">)</span></span>
<span><span class="va">theo_mean_z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">lambda2</span> <span class="op">/</span> <span class="va">lambda1</span><span class="op">)</span> <span class="op">/</span> <span class="va">theo_se</span></span>
<span></span>
<span><span class="co"># Critical value for 1-sided alpha (since we are looking at lower tail for RR &lt; 1)</span></span>
<span><span class="co"># However, the Z-scores here are negative (log(0.3/0.4) &lt; 0).</span></span>
<span><span class="co"># Rejection region is Z &lt; qnorm(alpha)</span></span>
<span><span class="va">crit_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">design_ref</span><span class="op">$</span><span class="va">inputs</span><span class="op">$</span><span class="va">alpha</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Proportion of simulations rejecting the null</span></span>
<span><span class="va">prop_reject</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">z_scores</span> <span class="op">&lt;</span> <span class="va">crit_val</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>z <span class="op">=</span> <span class="va">z_scores</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Simulated Density"</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">stat_function</a></span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="va">dnorm</span>,</span>
<span>    args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">theo_mean_z</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Theoretical Normal"</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"dashed"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">crit_val</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>,</span>
<span>    x <span class="op">=</span> <span class="va">crit_val</span>, y <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"  Reject: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">prop_reject</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%"</span><span class="op">)</span>,</span>
<span>    hjust <span class="op">=</span> <span class="fl">0</span>, vjust <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Distribution of Wald Z-scores"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Theoretical Mean Z ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">theo_mean_z</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Z-score (Estimate / Estimated SE)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Distribution"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<p><img src="verification-simulation_files/figure-html/z_score_dist-1.png" class="r-plt" alt="" width="700"></p>
<p>Given the apparent location difference in the above plot for the
simulation versus theoretical normal distribution, we can also examine
the theoretical versus simulation mean and standard deviation of <span class="math inline">\(log(\theta)\)</span> .</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Theoretical mean and SD of log(RR)</span></span>
<span><span class="co"># Let's also add median, skewness, and kurtosis</span></span>
<span><span class="va">theo_mean_log_rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">lambda2</span> <span class="op">/</span> <span class="va">lambda1</span><span class="op">)</span></span>
<span><span class="va">theo_sd_log_rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">theo_var</span><span class="op">)</span></span>
<span><span class="va">emp_mean_log_rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">estimate</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">emp_sd_log_rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">estimate</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">emp_median_log_rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">estimate</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Skewness and Kurtosis (using trimmed data to reduce outlier influence)</span></span>
<span><span class="co"># Trim extreme 1% on each tail for robust estimates</span></span>
<span><span class="va">ests</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">q_low</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">ests</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">q_high</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">ests</span>, <span class="fl">0.99</span><span class="op">)</span></span>
<span><span class="va">ests_trimmed</span> <span class="op">&lt;-</span> <span class="va">ests</span><span class="op">[</span><span class="va">ests</span> <span class="op">&gt;=</span> <span class="va">q_low</span> <span class="op">&amp;</span> <span class="va">ests</span> <span class="op">&lt;=</span> <span class="va">q_high</span><span class="op">]</span></span>
<span><span class="va">n_trimmed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ests_trimmed</span><span class="op">)</span></span>
<span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">ests_trimmed</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ests_trimmed</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span> <span class="op">/</span> <span class="va">n_trimmed</span></span>
<span><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">ests_trimmed</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ests_trimmed</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">4</span><span class="op">)</span> <span class="op">/</span> <span class="va">n_trimmed</span></span>
<span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">ests_trimmed</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ests_trimmed</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">n_trimmed</span></span>
<span><span class="va">emp_skew_log_rr</span> <span class="op">&lt;-</span> <span class="va">m3</span> <span class="op">/</span> <span class="va">s2</span><span class="op">^</span><span class="op">(</span><span class="fl">3</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">emp_kurt_log_rr</span> <span class="op">&lt;-</span> <span class="va">m4</span> <span class="op">/</span> <span class="va">s2</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="va">comparison_log_rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mean"</span>, <span class="st">"SD"</span>, <span class="st">"Median"</span>, <span class="st">"Skewness (trimmed)"</span>, <span class="st">"Kurtosis (trimmed)"</span><span class="op">)</span>,</span>
<span>  Theoretical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">theo_mean_log_rr</span>, <span class="va">theo_sd_log_rr</span>, <span class="va">theo_mean_log_rr</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  Simulated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">emp_mean_log_rr</span>, <span class="va">emp_sd_log_rr</span>, <span class="va">emp_median_log_rr</span>, <span class="va">emp_skew_log_rr</span>, <span class="va">emp_kurt_log_rr</span><span class="op">)</span>,</span>
<span>  Difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="va">emp_mean_log_rr</span> <span class="op">-</span> <span class="va">theo_mean_log_rr</span>,</span>
<span>    <span class="va">emp_sd_log_rr</span> <span class="op">-</span> <span class="va">theo_sd_log_rr</span>,</span>
<span>    <span class="va">emp_median_log_rr</span> <span class="op">-</span> <span class="va">theo_mean_log_rr</span>,</span>
<span>    <span class="va">emp_skew_log_rr</span> <span class="op">-</span> <span class="fl">0</span>,</span>
<span>    <span class="va">emp_kurt_log_rr</span> <span class="op">-</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Display table</span></span>
<span><span class="va">comparison_log_rr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html" class="external-link">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_header.html" class="external-link">tab_header</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/md.html" class="external-link">md</a></span><span class="op">(</span><span class="st">"**Comparison of log(RR) Statistics**"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html" class="external-link">fmt_number</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, decimals <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div id="vuzjcdmfnb" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#vuzjcdmfnb table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#vuzjcdmfnb thead, #vuzjcdmfnb tbody, #vuzjcdmfnb tfoot, #vuzjcdmfnb tr, #vuzjcdmfnb td, #vuzjcdmfnb th {
  border-style: none;
}

#vuzjcdmfnb p {
  margin: 0;
  padding: 0;
}

#vuzjcdmfnb .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vuzjcdmfnb .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#vuzjcdmfnb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vuzjcdmfnb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vuzjcdmfnb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vuzjcdmfnb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vuzjcdmfnb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vuzjcdmfnb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vuzjcdmfnb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vuzjcdmfnb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vuzjcdmfnb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vuzjcdmfnb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vuzjcdmfnb .gt_spanner_row {
  border-bottom-style: hidden;
}

#vuzjcdmfnb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#vuzjcdmfnb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vuzjcdmfnb .gt_from_md > :first-child {
  margin-top: 0;
}

#vuzjcdmfnb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vuzjcdmfnb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vuzjcdmfnb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vuzjcdmfnb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vuzjcdmfnb .gt_row_group_first td {
  border-top-width: 2px;
}

#vuzjcdmfnb .gt_row_group_first th {
  border-top-width: 2px;
}

#vuzjcdmfnb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vuzjcdmfnb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vuzjcdmfnb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vuzjcdmfnb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vuzjcdmfnb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vuzjcdmfnb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vuzjcdmfnb .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#vuzjcdmfnb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vuzjcdmfnb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vuzjcdmfnb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vuzjcdmfnb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vuzjcdmfnb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vuzjcdmfnb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vuzjcdmfnb .gt_left {
  text-align: left;
}

#vuzjcdmfnb .gt_center {
  text-align: center;
}

#vuzjcdmfnb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vuzjcdmfnb .gt_font_normal {
  font-weight: normal;
}

#vuzjcdmfnb .gt_font_bold {
  font-weight: bold;
}

#vuzjcdmfnb .gt_font_italic {
  font-style: italic;
}

#vuzjcdmfnb .gt_super {
  font-size: 65%;
}

#vuzjcdmfnb .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#vuzjcdmfnb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vuzjcdmfnb .gt_indent_1 {
  text-indent: 5px;
}

#vuzjcdmfnb .gt_indent_2 {
  text-indent: 10px;
}

#vuzjcdmfnb .gt_indent_3 {
  text-indent: 15px;
}

#vuzjcdmfnb .gt_indent_4 {
  text-indent: 20px;
}

#vuzjcdmfnb .gt_indent_5 {
  text-indent: 25px;
}

#vuzjcdmfnb .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#vuzjcdmfnb div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading">
<td colspan="4" class="gt_heading gt_title gt_font_normal gt_bottom_border" style><span class="gt_from_md"><strong>Comparison of log(RR) Statistics</strong></span></td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Metric">Metric</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Theoretical">Theoretical</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Simulated">Simulated</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Difference">Difference</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr>
<td headers="Metric" class="gt_row gt_left">Mean</td>
<td headers="Theoretical" class="gt_row gt_right">−0.2877</td>
<td headers="Simulated" class="gt_row gt_right">−0.2891</td>
<td headers="Difference" class="gt_row gt_right">−0.0014</td>
</tr>
<tr>
<td headers="Metric" class="gt_row gt_left">SD</td>
<td headers="Theoretical" class="gt_row gt_right">0.0887</td>
<td headers="Simulated" class="gt_row gt_right">0.0908</td>
<td headers="Difference" class="gt_row gt_right">0.0021</td>
</tr>
<tr>
<td headers="Metric" class="gt_row gt_left">Median</td>
<td headers="Theoretical" class="gt_row gt_right">−0.2877</td>
<td headers="Simulated" class="gt_row gt_right">−0.2912</td>
<td headers="Difference" class="gt_row gt_right">−0.0036</td>
</tr>
<tr>
<td headers="Metric" class="gt_row gt_left">Skewness (trimmed)</td>
<td headers="Theoretical" class="gt_row gt_right">0.0000</td>
<td headers="Simulated" class="gt_row gt_right">0.0603</td>
<td headers="Difference" class="gt_row gt_right">0.0603</td>
</tr>
<tr>
<td headers="Metric" class="gt_row gt_left">Kurtosis (trimmed)</td>
<td headers="Theoretical" class="gt_row gt_right">3.0000</td>
<td headers="Simulated" class="gt_row gt_right">2.5078</td>
<td headers="Difference" class="gt_row gt_right">−0.4922</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The simulation results confirm that <code><a href="../reference/sample_size_nbinom.html">sample_size_nbinom()</a></code>
reasonably predicts average exposure, variance (information), and power
for this complex design with piecewise accrual and dropout. However,
given the slight underpowering that the simulation study suggests, it
may be useful to consider a larger sample size than the Friede
approximation suggests, with power verified by simulation.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Keaven Anderson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
